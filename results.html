<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>検索結果｜トマトささみ 公式HP</title>

  <style>
    :root{
      --bg: #f7f7f0;
      --band: #d9ead3;
      --accent: #c0392b;
      --text: #111;
      --line: #cfcfcf;
      --footer: #b33226;
      --maxw: 1040px;
      --font-main: "Hiragino Mincho ProN","Yu Mincho","YuMincho",serif;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: var(--font-main);
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display:flex;
      flex-direction:column;
    }

    header{
      background:#fff;
      border-bottom: 1px solid #ddd;
    }
    .header-inner{
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 18px 18px 12px;
      display:flex;
      align-items:center;
      gap:16px;
      justify-content: space-between;
    }
    .brand{
      display:flex;
      align-items:baseline;
      gap:10px;
      min-width: 260px;
    }
    .brand .title{
      font-size: 26px;
      letter-spacing: 0.08em;
      font-weight: 700;
    }
    .brand .subtitle{
      font-size: 12px;
      opacity: 0.75;
      letter-spacing: 0.06em;
    }

    .search-wrap{
      display:flex;
      align-items:center;
      gap:8px;
      width: min(520px, 100%);
      justify-content:flex-end;
    }
    .search-wrap input{
      width: 360px;
      max-width: 55vw;
      padding: 10px 12px;
      border: 1px solid var(--accent);
      outline:none;
      font-size: 14px;
      background:#fff;
      font-family: var(--font-main);
    }
    .search-wrap button{
      padding: 10px 14px;
      border: 1px solid var(--accent);
      background: var(--accent);
      color:#fff;
      cursor:pointer;
      font-size: 14px;
      white-space: nowrap;
      font-family: var(--font-main);
    }
    .search-wrap button:hover{ opacity:.9; }

    nav{
      background: var(--band);
      border-top: 1px solid #cfe2c8;
      border-bottom: 1px solid #cfe2c8;
    }
    .nav-inner{
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 0 18px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      height:52px;
    }
    .nav-inner a{
      text-decoration:none;
      color:#0f2a0f;
      padding:10px 14px;
      border-right:1px solid rgba(0,0,0,0.12);
      font-size:14px;
      letter-spacing:.04em;
      font-family: var(--font-main);
    }
    .nav-inner a:last-child{ border-right:none; }
    .nav-inner a:hover{ opacity:.75; }

    main{
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 18px;
      flex:1;
    }

    /* 検索結果（白枠） */
    .result-box{
      border:1px solid var(--line);
      background:#fff;
      padding: 22px;
      margin: 10px 0 18px;
    }

    .result-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:10px;
    }
    .result-title{
      font-size: 18px;
      font-weight: 700; /* ←太字 */
      letter-spacing:.04em;
    }
    .count{
      font-size: 12px;
      opacity:.7;
      letter-spacing:.06em;
    }

    .hr{
      border:0;
      border-top:1px solid #e2e2e2;
      margin: 12px 0 14px;
    }

    .hint{
      font-size: 13px;
      opacity:.85;
      line-height: 1.9;
      margin: 0;
    }

    /* ヒット一覧 */
    .hits{
      margin-top: 16px;
      display:grid;
      gap: 12px;
    }
    .hit{
      border: 1px solid #e3e3e3;
      background:#fff;
      padding: 14px;
    }
    .hit a{
      color: #0f2a0f;
      text-decoration:none;
      border-bottom: 1px dotted rgba(15,42,15,.45);
    }
    .hit a:hover{ opacity:.8; }
    .hit .meta{
      font-size: 12px;
      opacity:.7;
      margin-top: 6px;
      line-height:1.8;
    }

    .badge{
      display:inline-block;
      font-size: 11px;
      border:1px solid #1f3f1f;
      padding: 2px 8px;
      margin-left: 8px;
      opacity:.85;
    }

    /* ページ番号 */
    .progress{
      text-align:right;
      margin: 18px 4px 8px;
      font-size:12px;
      letter-spacing:.08em;
      color:#333;
    }

    footer{
      background: var(--footer);
      color:#fff;
    }
    .footer-inner{
      max-width: var(--maxw);
      margin:0 auto;
      padding: 16px 18px;
      font-size:12px;
      line-height:1.8;
    }

    @media (max-width: 920px){
      .search-wrap input{ width: 52vw; }
    }
  </style>
</head>

<body>
  <header>
    <div class="header-inner">
      <div class="brand">
        <div class="title">トマトささみ</div>
        <div class="subtitle">公式HP</div>
      </div>

      <div class="search-wrap">
        <input id="keyword" type="text" placeholder="検索キーワードを入力してください" />
        <button onclick="search()">検索</button>
      </div>
    </div>

    <nav>
      <div class="nav-inner">
        <a href="./index.html">トップ</a>
        <a href="./members.html">メンバー</a>
        <a href="./schedule.html">スケジュール</a>
        <a href="./discord.html">ディスコード</a>
        <a href="./contact.html">お問い合わせ</a>
      </div>
    </nav>
  </header>

  <main>

    <!-- 検索結果（ここだけで完結） -->
    <section class="result-box">
      <div class="result-header">
        <div class="result-title">
          検索結果：<span id="result-keyword">（未入力）</span>
          <span id="and-badge" class="badge" style="display:none;">複合</span>
        </div>
        <div class="count"><span id="result-count">0</span>件</div>
      </div>

      <hr class="hr">

      <!-- 0件/注意メッセージ -->
      <p id="result-message" class="hint">
        申し訳ございませんが、お探しの情報に関する記事は見つかりませんでした。<br>
        1〜2のキーワードを検索することで、資料が見つかる場合があります。<br><br>
        当サイトの検索仕様上、3つ以上のキーワードで見つかる記事はありません。
      </p>

      <!-- ヒット一覧（ここに挿入） -->
      <div id="hits" class="hits" style="display:none;"></div>
    </section>

    <div class="progress">0/108 (LV0)</div>
  </main>

  <footer>
    <div class="footer-inner">
      このWebサイトの内容は考察コンテンツのために作られたフィクションであり、<br>
      実在の人物・団体・コミュニティとは一切関係ありません。
    </div>
  </footer>

  <script>
    /* =========================
       1) ルール（辞書）をここに追加していく
       tokens: 1語 or 2語（AND）
       url: 遷移先
       title/snippet: 結果表示用
    ========================= */
    const RULES = [
      // 例：単語1つでヒット
      { tokens: ["みる"], url: "pages/observe.html", title: "観測", snippet: "閲覧記録の参照リンクが存在します。" },

      // 例：2語ANDでヒット（複合）
      // { tokens: ["みか","きろく"], url: "pages/mika-log.html", title: "外部ログ参照", snippet: "対象発言の引用記録（抜粋）" },
    ];

    /* =========================
       2) URL ?q= を読み取る
    ========================= */
    const params = new URLSearchParams(window.location.search);
    const rawQ = (params.get("q") || "").trim();

    // 表示用（そのまま見せる）
    document.getElementById("result-keyword").textContent = rawQ ? rawQ : "（未入力）";

    /* =========================
       3) トークン化（複数キーワード対応）
       - スペース、全角スペース、+、,、／、・、| などを区切りにする
       - 最大2語まで（仕様）
    ========================= */
    function tokenize(q){
      if(!q) return [];
      const cleaned = q
        .toLowerCase()
        .replace(/[　]+/g, " ")         // 全角スペース→半角
        .replace(/[+,、／・|]+/g, " ")  // 区切り記号→スペース
        .replace(/\s+/g, " ")
        .trim();

      if(!cleaned) return [];
      return cleaned.split(" ").filter(Boolean);
    }

    const tokens = tokenize(rawQ);
    const andBadge = document.getElementById("and-badge");

    if(tokens.length >= 2) andBadge.style.display = "inline-block";

    // 仕様：3語以上はヒットさせない
    if(tokens.length >= 3){
      document.getElementById("result-count").textContent = "0";
      // messageはそのまま（3語以上は出ない）でOK
    } else {
      /* =========================
         4) マッチ判定（AND検索）
         - RULE.tokens がすべて tokens に含まれたらヒット
         - 2語ルールを優先して並べる（desc）
      ========================= */
      function includesAll(inputTokens, ruleTokens){
        return ruleTokens.every(rt => inputTokens.includes(rt));
      }

      // より具体（2語）を先に出すためソート
      const sorted = [...RULES].sort((a,b) => (b.tokens.length - a.tokens.length));

      const hits = sorted.filter(rule => includesAll(tokens, rule.tokens));

      const hitsWrap = document.getElementById("hits");
      const message = document.getElementById("result-message");
      const countEl = document.getElementById("result-count");

      if(hits.length > 0){
        countEl.textContent = String(hits.length);
        message.style.display = "none";
        hitsWrap.style.display = "grid";

        hitsWrap.innerHTML = hits.map(h => {
          const t = h.title || "資料";
          const s = h.snippet || "";
          const k = h.tokens.join(" ");
          return `
            <div class="hit">
              <div>
                <a href="${h.url}">${t}</a>
              </div>
              <div class="meta">
                該当キーワード：${k}<br>
                ${s}
              </div>
            </div>
          `;
        }).join("");
      } else {
        countEl.textContent = "0";
        // messageは表示のまま
      }
    }

    /* =========================
       5) 上の検索バーも A案（resultsへ）
    ========================= */
    function normalizeInput(s){
      return (s || "").trim();
    }
    function search(){
      const input = normalizeInput(document.getElementById("keyword").value);
      location.href = "results.html?q=" + encodeURIComponent(input);
    }
    document.addEventListener("keydown", (e) => {
      if (e.key === "Enter") search();
    });
  </script>
</body>
</html>
